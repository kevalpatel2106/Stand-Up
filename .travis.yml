language: android
jdk: oraclejdk8
sudo: required
dist: precise

notifications:
  slack:
    secure: VoNMKOrdHjRhUxErEwzbymPbKxvtz3Mf9Gw3cEnH0F/wOD+dZlY2cCsLs/gSWfEgjBzUsziwKnkdo3s8jGQjTiKps6eVT7Ufae/VJyCOzF9m60UQAvNsqdHQO71QhOGh9WBvgf2IfTi7U0M+rblBaajqfmIQEsS+I41pbaXwE0ZciH9cekwtNqd+zKxYCipKpl4xKh3PJdrA3Dac2zHOObq1AyJ39eTDclx0//+5p4gPW/awcZxzwagu712Mjd8TCUFQ7j8q4iBppil7DnthmJ6CwQzqavTBekpQuOTWBCEEoOr5kkpj3290Y0EsCNwj+o8t2HvBWhkizNLKjx07PUDYhYHNrBev7zKg0TFoMPaYVx8r6uiYT6XESQFjc/pL5pBpQzj+RlPahSb82wfdKBTXX0mIjayHLM4Yyh6n9pJTxADXfwl/k21T7mb7FyXaCXipSIL8EwV+3uMlF3LXy05VQIJCUmk7Z8PZ1mGsVzA7swCRgyh/EoGXRp070odMKVJKAeqppELw5IOkLdF5rrPXShsVzQpbPThtjVirHaaetf5mdxDCk2BrczBwzRrJpKNxesXuPjibdh7FLgkl5X9PNJG7LqeEukgboRmvJNppe1Jgpzh8iZoGx7eFhQkzfKq84Igkf+owsMyvtamFTG4hfuJu5R9gk1rIqmbikNg=
  email: false

env:
  global:
    - ADB_INSTALL_TIMEOUT=10

before_install:
  # Set encrypted files
  - openssl aes-256-cbc -K $encrypted_3d7fa878c23a_key -iv $encrypted_3d7fa878c23a_iv -in misc/secrets.tar.enc -out secrets.tar -d
  - tar xvf secrets.tar
  - mv google-services.json ./app
  - mv .dropbox_uploader_config ./scripts

  # Install npm
  - curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.3/install.sh | bash

  #https://github.com/travis-ci/travis-ci/issues/8874
  - yes | sdkmanager "platforms;android-27"

before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -f  $HOME/.gradle/caches/transforms-1/transforms-1.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/

cache:
  directories:
    - "$HOME/.gradle/caches/"
    - "$HOME/.gradle/wrapper/"
    - "$HOME/.android/build-cache"

android:
  components:
    - platform-tools
    - tools
    - build-tools-27.0.2
    - android-27
    - extra-google-m2repository
    - extra-android-m2repository
  licenses:
    - android-sdk-preview-license-.+
    - android-sdk-license-.+
    - google-gdk-license-.+

before_script:
  - chmod +x gradlew
  - android list targets
  - android list device

script:
  - ./gradlew app:assembleDebug --continue --stacktrace --profile --parallel

after_success:
  - bash <(curl -s https://codecov.io/bash)
  - cd scripts

  - chmod +x dependency_check.sh
  - bash dependency_check.sh

  - chmod +x upload-artifacts.sh
  - bash upload-artifacts.sh

after_failure:
  - cd scripts
  - chmod +x upload-artifacts.sh
  - bash upload-artifacts.sh
