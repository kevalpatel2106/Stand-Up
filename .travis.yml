language: android
jdk: oraclejdk8
sudo: required
dist: precise

notifications:
  slack:
    secure: VoNMKOrdHjRhUxErEwzbymPbKxvtz3Mf9Gw3cEnH0F/wOD+dZlY2cCsLs/gSWfEgjBzUsziwKnkdo3s8jGQjTiKps6eVT7Ufae/VJyCOzF9m60UQAvNsqdHQO71QhOGh9WBvgf2IfTi7U0M+rblBaajqfmIQEsS+I41pbaXwE0ZciH9cekwtNqd+zKxYCipKpl4xKh3PJdrA3Dac2zHOObq1AyJ39eTDclx0//+5p4gPW/awcZxzwagu712Mjd8TCUFQ7j8q4iBppil7DnthmJ6CwQzqavTBekpQuOTWBCEEoOr5kkpj3290Y0EsCNwj+o8t2HvBWhkizNLKjx07PUDYhYHNrBev7zKg0TFoMPaYVx8r6uiYT6XESQFjc/pL5pBpQzj+RlPahSb82wfdKBTXX0mIjayHLM4Yyh6n9pJTxADXfwl/k21T7mb7FyXaCXipSIL8EwV+3uMlF3LXy05VQIJCUmk7Z8PZ1mGsVzA7swCRgyh/EoGXRp070odMKVJKAeqppELw5IOkLdF5rrPXShsVzQpbPThtjVirHaaetf5mdxDCk2BrczBwzRrJpKNxesXuPjibdh7FLgkl5X9PNJG7LqeEukgboRmvJNppe1Jgpzh8iZoGx7eFhQkzfKq84Igkf+owsMyvtamFTG4hfuJu5R9gk1rIqmbikNg=
  email: false

env:
  global:
    - ADB_INSTALL_TIMEOUT=10
    - secure: "VovMnREcPad+ZEjDYDQ3bmKs0wMR9U7u+EClnv6Dc8PRC0Pw+4ubjPkevPppJd26gYDAClVfLWRnuQLkb0Qgpu5jqGqMpt+lAn2bSH5VFN8vNUz075BYXQfz9aKgGOTlGvRx4eLBU88Vh4Z8xYyL4IuTiEbOE8VBTEtbTT/Q7gTdwCjr7gDRfIisWoL9QnEVJiy7BLZYsY2rP0Q5tiGx1JCyrE+YUU5bLsWZ7jXI/l3wxrqFL6TGNG1oa6dh3MQ1EwFuONO0kIbdk0eo0s9iqQZfiDgQgyidRmdkvP9jm/0NFXyQoGcJgtcWluBHoMiVH/5aKwTR1YEIgcyg4qH904YeZ25nevWzJAoRq03gP2mRhUaJRGJQtzRMSefaN9NHWz0qhSwGVMz1U+YSgM640oIRiIfEQo0nB1fBxJJwoLRoZmFBWB2J/TaMW+Rv65B9i+Ki2JqOvHFzdp/MtiiU++pN+CVZS+nbeRiyAAWsAwuO80uTMxnYoE1LiqJORsH7Pq2/f9ungf2guuyTVOBl1f6Lg52A0FQuAU09s2Fx99zAWM3GfBOUHfoB2DAxxta0rkk1Vo/q2UlTI+i93WJRqKxahXQLvT/yYWmeADNSnnvCiF58+y6s04jOtPLddhX/M2zGEbcMOaRMyXPBqbtEq6XwMqdzAwYAtDGCUe+yrIQ="

before_install:
  # Set encrypted files
  - openssl aes-256-cbc -K $encrypted_3d7fa878c23a_key -iv $encrypted_3d7fa878c23a_iv -in misc/secrets.tar.enc -out secrets.tar -d
  - tar xvf secrets.tar
  - mv google-services.json ./app
  - mv .dropbox_uploader_config ./scripts

  # Install npm
  - curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.3/install.sh | bash

before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -f  $HOME/.gradle/caches/transforms-1/transforms-1.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/

cache:
  directories:
    - "$HOME/.gradle/caches/"
    - "$HOME/.gradle/wrapper/"
    - "$HOME/.android/build-cache"

android:
  components:
    - platform-tools
    - tools
    - build-tools-27.0.2
    - android-26
    - extra-google-m2repository
    - extra-android-m2repository
  licenses:
    - android-sdk-preview-license-.+
    - android-sdk-license-.+
    - google-gdk-license-.+

before_script:
  - chmod +x gradlew
  - android list targets
  - android list device

script:
  - chmod +x ./scripts/ci-script.sh
  - bash ./scripts/ci-script.sh

after_success:
  - bash <(curl -s https://codecov.io/bash)

  - chmod +x ./scripts/dependency_check.sh
  - bash ./scripts/dependency_check.sh

  - chmod +x ./scripts/upload-artifacts.sh
  - bash ./scripts/upload-artifacts.sh

after_failure:
  - chmod +x ./scripts/upload-artifacts.sh
  - bash ./scripts/upload-artifacts.sh
